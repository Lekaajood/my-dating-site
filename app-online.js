
let INDEX=[], CACHE={};
function photoFallback(id){ return `https://picsum.photos/seed/girl${id}/400/400`; }
async function fetchIndex(){ try{ const r=await fetch('profiles/index.json',{cache:'no-store'}); INDEX=await r.json(); INDEX=INDEX.map(e=>({...e,photo:e.photo||photoFallback(e.id)})); }catch(e){ INDEX=Array.from({length:12},(_,i)=>({id:i+1,name:'مجهولة '+(i+1),hobby:'—',photo:photoFallback(i+1)})); } }
async function fetchProfile(id){ if(CACHE[id]) return CACHE[id]; try{ const r=await fetch(`profiles/${id}.json`,{cache:'no-store'}); const d=await r.json(); d.photo=d.photo||photoFallback(id); CACHE[id]=d; return d;}catch(e){ const lite=INDEX.find(x=>x.id===id)||{id,name:'مجهولة',hobby:'—',photo:photoFallback(id)}; const d={id,name:lite.name,age:25,city:'—',height_cm:165,weight_kg:55,hobby:lite.hobby,photo:lite.photo}; CACHE[id]=d; return d;}}
function renderOnline(){ const root=document.getElementById('onlineCards'); const list=INDEX.slice(0,12); root.innerHTML=list.map(e=>`<div class="card"><img src="${e.photo}" alt="${e.name}"><div class="body"><div class="name" data-id="${e.id}">${e.name}</div><div class="meta">الهواية: ${e.hobby||'—'}</div><div class="actions"><a href="#" class="btn message" data-id="${e.id}">راسلها</a></div></div></div>`).join(''); root.querySelectorAll('.name').forEach(n=>n.addEventListener('click', async (ev)=>{ const id=Number(ev.currentTarget.getAttribute('data-id')); const p=await fetchProfile(id); const modal=document.getElementById('profileModal'); const body=document.getElementById('profileBody'); body.innerHTML=`<div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap"><img src="${p.photo}" alt="${p.name}" style="width:180px;height:180px;object-fit:cover;border-radius:10px;border:1px solid #eee"><div style="flex:1"><div class="detail"><div>الاسم</div><div>${p.name}</div></div><div class="detail"><div>العمر</div><div>${p.age||'—'}</div></div><div class="detail"><div>المدينة</div><div>${p.city||'—'}</div></div><div class="detail"><div>الطول</div><div>${p.height_cm||'—'} سم</div></div><div class="detail"><div>الوزن</div><div>${p.weight_kg||'—'} كغ</div></div><div class="detail"><div>الهواية</div><div>${p.hobby||'—'}</div></div></div></div>`; modal.classList.remove('hidden'); })); document.getElementById('closeProfile').addEventListener('click', ()=>document.getElementById('profileModal').classList.add('hidden')); }
document.addEventListener('DOMContentLoaded', async ()=>{ await fetchIndex(); renderOnline(); });
